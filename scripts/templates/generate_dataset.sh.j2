#!/bin/bash
#SBATCH -c 16                           # Number of cores (-c)
#SBATCH -t 0-3:00                       # Runtime in D-HH:MM, minimum of 10 minutes
#SBATCH -p sapphire                     # Partition to submit to
#SBATCH --mem=32000                     # Memory pool for all cores (see also --mem-per-cpu)
#SBATCH -o job_outputs/myoutput_%j.out  # File to which STDOUT will be written, %j inserts jobid
#SBATCH -e job_outputs/myerrors_%j.err  # File to which STDERR will be written, %j inserts jobid

# Dataset generation script for {{ experiment_name }}
mkdir -p job_outputs

# Load modules
module load ncf/1.0.0-fasrc01
module load miniconda3/py310_22.11.1-1-linux_x64-ncf
module load cuda/12.2.0-fasrc01

# Activate conda env
source ~/.bashrc
conda activate ten

# DEFINE EXP ARGUMENTS
LIFTERS=({{ lifters | join(' ') }})
NEIGHBOR_TYPES="{{ neighbor_types }}"
CONNECTIVITY="{{ connectivity }}"
VISIBLE_DIMS=({{ visible_dims | join(' ') }})
INITIAL_FEATURES="{{ initial_features }}"
DIM={{ dim }}

# Command to generate dataset
python src/create_dataset.py --lifters "${LIFTERS[@]}" \
                             --neighbor_types "$NEIGHBOR_TYPES" \
                             --connectivity "$CONNECTIVITY" \
                             --visible_dims "${VISIBLE_DIMS[@]}" \
                             --initial_features "$INITIAL_FEATURES" \
                             --dim "$DIM" \
                            {% if triangles_only == true %} --triangles_only {% endif %}
